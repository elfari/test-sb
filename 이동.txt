SET SERVEROUTPUT ON; -- 출력 결과를 보기 위해 필수 설정

DECLARE
    -- 1. 문자열을 담을 배열 타입 정의 (가변 배열)
    TYPE t_keyword_array IS TABLE OF VARCHAR2(100);
    
    -- 2. 검색할 키워드 리스트 초기화
    v_keywords t_keyword_array := t_keyword_array('C4', '사불', 'd4', '플루', 'f23', '화학');
    
BEGIN
    -- 3. 키워드 배열만큼 반복 (Outer Loop)
    FOR i IN 1 .. v_keywords.COUNT LOOP
        
        -- 헤더 출력
        DBMS_OUTPUT.PUT_LINE('[' || v_keywords(i) || '] 조회한결과');
        
        -- 4. 해당 키워드로 테이블 조회 및 결과 반복 (Inner Loop)
        --    별도의 커서 선언 없이 FOR LOOP 안에서 바로 쿼리 사용 (Implicit Cursor)
        FOR r IN (
            SELECT mastid, item_name
              FROM prop_strn_item_name
             WHERE UPPER(propvalue) LIKE UPPER('%' || v_keywords(i) || '%')
        ) LOOP
            -- 결과 출력 (splitter ^ 로 연결)
            DBMS_OUTPUT.PUT_LINE(r.mastid || '^' || r.item_name);
        END LOOP;
        
        -- 키워드 그룹 간 줄바꿈이 필요하다면 아래 주석 해제
        -- DBMS_OUTPUT.NEW_LINE; 
        
    END LOOP;
END;
/
