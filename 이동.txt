WITH RAW_DATA AS (
    -- 입력 문자열 정의
    SELECT '갤럭시 갤럭시 S25!@#' AS target_str FROM DUAL
),
STEP_1 AS (
    -- 1단계: 영문, 숫자, 한글, 중문 제외 공백 치환
    SELECT REGEXP_REPLACE(target_str, '[^a-zA-Z0-9가-힣一-龥]', ' ') AS clean_str
    FROM RAW_DATA
),
STEP_2 AS (
    -- 2단계: 파싱 및 중복 제거
    SELECT LISTAGG(word, ' ') WITHIN GROUP (ORDER BY pos) AS final_str
    FROM (
        SELECT DISTINCT 
               REGEXP_SUBSTR(clean_str, '[^ ]+', 1, LEVEL) AS word,
               MIN(LEVEL) AS pos
        FROM STEP_1
        CONNECT BY REGEXP_SUBSTR(clean_str, '[^ ]+', 1, LEVEL) IS NOT NULL
        GROUP BY REGEXP_SUBSTR(clean_str, '[^ ]+', 1, LEVEL)
    )
)
-- 1단계와 2단계를 각각 행으로 출력
SELECT '1단계 (특수문자 제거)' AS STAGE, clean_str AS RESULT FROM STEP_1
UNION ALL
SELECT '2단계 (중복 단어 제거)', final_str FROM STEP_2;
