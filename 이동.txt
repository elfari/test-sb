import os
import csv

# 검색 대상 키워드
keywords = ["설비", "자재", "고객", "협력사", "사원", "조직"]

# 검색 대상 확장자
target_extensions = [".java", ".jsp"]

# 검색할 디렉토리 경로
target_dir = "C:/path/to/your/directory"

# 결과 파일명
output_csv = "multi_domain_search_result.csv"


def search_files(base_dir, extensions, keywords):
    result = []

    for root, _, files in os.walk(base_dir):
        for file in files:
            if any(file.endswith(ext) for ext in extensions):
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r", encoding="utf-8") as f:
                        content = f.read()
                        found = [kw for kw in keywords if kw in content]
                        if len(found) >= 2:
                            result.append((file_path, len(found), ", ".join(found)))
                except Exception as e:
                    print("파일을 읽을 수 없습니다:", file_path, "(", e, ")")
    return result


def save_to_csv(rows, csv_path):
    # 엑셀 호환을 위해 utf-8-sig 사용
    with open(csv_path, "w", newline="", encoding="utf-8-sig") as fp:
        writer = csv.writer(fp)
        writer.writerow(["파일", "포함된키워드개수", "포함된키워드"])
        for path, count, found_str in rows:
            writer.writerow([path, count, found_str])


if __name__ == "__main__":
    matched = search_files(target_dir, target_extensions, keywords)

    # 콘솔 출력 (요청하신 포맷)
    print("파일,포함된키워드개수,포함된키워드")
    for path, count, found_str in matched:
        print("{},{},{}".format(path, count, found_str))

    # CSV 저장
    save_to_csv(matched, output_csv)
    print("총", len(matched), "개의 파일이 조건에 해당합니다.")
    print("결과 저장:", output_csv)